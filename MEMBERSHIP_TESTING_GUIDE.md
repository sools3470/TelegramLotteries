# راهنمای تست سیستم عضویت کانال‌های اسپانسری

## مرحله 1️⃣: بررسی تنظیمات اولیه ربات تلگرام

### 1.1 بررسی BOT_TOKEN
- وارد تنظیمات Secrets شوید
- مطمئن شوید BOT_TOKEN موجود و معتبر است
- اگر ندارید، از @BotFather یک ربات جدید بسازید

### 1.2 تست اتصال ربات
```bash
# در terminal اجرا کنید:
curl -X GET "https://api.telegram.org/bot[BOT_TOKEN]/getMe"
```

## مرحله 2️⃣: تنظیم کانال‌های اسپانسری

### 2.1 ایجاد کانال تست
- یک کانال تلگرام جدید بسازید
- ربات را به عنوان ادمین اضافه کنید (ضروری!)

### 2.2 اضافه کردن کانال به سیستم
1. وارد بخش ادمین شوید
2. تب "کانال‌های اسپانسری" را باز کنید
3. "افزودن کانال جدید" را کلیک کنید
4. اطلاعات کانال را وارد کنید:
   - نام کانال: نام نمایشی
   - شناسه کانال: @channel_username یا Channel ID
   - لینک کانال: https://t.me/channel_username
   - امتیاز پاداش: مثلاً 100
   - ویژه بودن: تیک بزنید یا نه

## مرحله 3️⃣: تست دسترسی ربات به کانال

### 3.1 بررسی دسترسی از طریق لاگ
- در workflow console بررسی کنید:
```
✅ Channel accessible: نام_کانال
❌ Bot has no access: نام_کانال
```

### 3.2 حل مشکل عدم دسترسی
اگر "Bot has no access" می‌بینید:
1. ربات را به کانال اضافه کنید
2. مطمئن شوید ربات Admin است (نه فقط عضو)
3. دسترسی‌های مورد نیاز را بدهید:
   - دیدن پیام‌ها
   - مدیریت کاربران

## مرحله 4️⃣: تست رابط کاربری عضویت

### 4.1 ورود به تب عضویت
1. وارد اپلیکیشن شوید
2. تب "عضویت" را انتخاب کنید

### 4.2 بررسی نمایش کانال‌ها
باید موارد زیر را ببینید:
- ✅ کانال‌هایی که ربات دسترسی دارد
- ⚠️ کانال‌هایی که ربات دسترسی ندارد
- 📊 آمار کل امتیازات

## مرحله 5️⃣: تست فرآیند عضویت

### 5.1 تست عضویت واقعی
1. در یک کانال عضو شوید
2. در اپ روی "بررسی عضویت" کلیک کنید
3. باید پیام موفقیت و امتیاز ببینید

### 5.2 تست عدم عضویت
1. از یک کانال خارج شوید
2. روی "بررسی عضویت" کلیک کنید
3. باید پیام "عضو نیستید" ببینید

## مرحله 6️⃣: تست سیستم امتیازدهی

### 6.1 بررسی امتیازات
- در تب عضویت، کل امتیازات را ببینید
- هر بار عضویت جدید، امتیاز باید اضافه شود

### 6.2 تست عضویت مجدد
- اگر قبلاً عضو بوده‌اید، امتیاز اضافه نشود
- فقط وضعیت عضویت به‌روزرسانی شود

## مرحله 7️⃣: تست سیستم زمان‌بندی خودکار

### 7.1 بررسی scheduler
در workflow console باید ببینید:
```
📋 Starting scheduled membership check...
📊 Found X active sponsor channels
```

### 7.2 تست به‌روزرسانی خودکار
- عضویت/خروج از کانال
- صبر کنید تا scheduler اجرا شود (هر 15 دقیقه)
- وضعیت باید خودکار به‌روزرسانی شود

## مرحله 8️⃣: تست API endpoints مستقیم

### 8.1 تست دریافت کانال‌ها
```bash
curl "http://localhost:5173/api/user/USER_ID/available-channels"
```

### 8.2 تست بررسی عضویت
```bash
curl -X POST "http://localhost:5173/api/user/USER_ID/check-membership/CHANNEL_ID"
```

### 8.3 تست دریافت عضویت‌ها
```bash
curl "http://localhost:5173/api/user/USER_ID/sponsor-memberships"
```

## مرحله 9️⃣: تست مدیریت کانال‌ها

### 9.1 تست ترتیب کانال‌ها
- در بخش ادمین، کانال‌ها را drag & drop کنید
- ترتیب باید در رابط کاربری اعمال شود

### 9.2 تست حذف/ویرایش
- کانال‌ها را ویرایش کنید
- تغییرات باید در همه‌جا اعمال شود

## مرحله 🔟: تست مسائل امنیتی

### 10.1 تست محافظت از API
- بدون ورود به سیستم، API ها دسترسی ندهند
- کاربران معمولی نتوانند کانال‌ها را تغییر دهند

### 10.2 تست محافظت از تقلب
- کاربران نتوانند امتیاز جعلی بسازند
- سیستم تشخیص دهد اگر واقعاً عضو نیستند

## نشانه‌های موفقیت ✅

سیستم درست کار می‌کند اگر:
- ✅ ربات به کانال‌ها دسترسی دارد
- ✅ عضویت واقعی تشخیص داده می‌شود
- ✅ امتیازات درست محاسبه می‌شوند
- ✅ رابط کاربری به‌روزرسانی می‌شود
- ✅ scheduler خودکار کار می‌کند
- ✅ API های محافظت شده‌اند

## مشکلات رایج و راه‌حل 🔧

### مشکل: "Bot has no access"
**راه‌حل:** ربات را Admin کانال کنید

### مشکل: "Request failed with status code 400"
**راه‌حل:** شناسه کانال را درست وارد کنید

### مشکل: امتیاز اضافه نمی‌شود
**راه‌حل:** مطمئن شوید واقعاً عضو کانال هستید

### مشکل: رابط کاربری به‌روزرسانی نمی‌شود
**راه‌حل:** صفحه را refresh کنید یا cache را پاک کنید